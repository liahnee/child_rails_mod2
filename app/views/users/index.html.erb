<h2> All Users and Their Main Children </h2>

<% @users.each do |user| %>
    <b><%= user.username %></b>
    <ul>
    <% if MainChild.find_by(user_id:user.id) %>
        <% @main_children = [] %>
        <% MainChild.all.each do |child| %>
            <% if child.user_id == user.id %>
                <% @main_children << child %>
            <% end %>
        <% end %>
        <% @main_children.each do |mchild| %>
            <li> 
            <% child = Child.find(mchild.child_id) %>
            <%= link_to child.full_name, main_child_path(mchild.id) %><br>  
            </li>
            Job: <%= child.job.title %>
        <% end %>
    <% else %>
        This user has not setup main child yet.
    <% end %>
    </ul>
<% end %>

<br><br>
<% if !session[:username] == nil %>
    <% if session[:username].empty? %>
        <%= link_to "Back to My Children", user_path(@current_user.id) %>
    <% end %>
<% else %>
    <%= link_to "Login", login_path %><br>
    <%= link_to "Create New User", new_user_path %><br>
<% end %>
